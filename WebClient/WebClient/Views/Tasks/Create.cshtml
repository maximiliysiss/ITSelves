@model CommonLibrary.Models.Task

@{
    Layout = "_Layout";
    List<CommonLibrary.Models.Worker> workers = ViewBag.Workers;
    CommonLibrary.Models.User userName = ViewBag.User;
}


<style>
    .lineFull {
        height: 40px;
    }

        .lineFull > td {
            padding: 5px;
            text-align: center;
            width: 100px;
        }

    .bblock {
        background-color: #7CFC44;
        height: 20px;
    }

    .oblock {
        background-color: lightgrey;
        height: 20px;
    }
</style>

<form asp-action="Create">

    <div style="padding: 15px">
        <table style="width:100%; border: 3px solid; border-radius: 20px; -moz-border-radius: 30px; -webkit-border-radius: 30px; border-color: #9978DB">
            <tr class="lineFull">
                <td>Создание</td>
                <td>Модерация</td>
                <td>В работе</td>
                <td>Оценка</td>
                <td>Завершена</td>
            </tr>
            <tr class="lineFull">
                <td><div class="bblock"></div></td>
                <td><div class="@(Model.TaskStatus >= CommonLibrary.TaskStatus.InConsideration ? "bblock" : "oblock"))"></div></td>
                <td><div class="@(Model.TaskStatus >= CommonLibrary.TaskStatus.InProgress ? "bblock" : "oblock"))"></div></td>
                <td><div class="@(Model.TaskStatus >= CommonLibrary.TaskStatus.Mark ? "bblock" : "oblock"))"></div></td>
                <td><div class="@(Model.TaskStatus >= CommonLibrary.TaskStatus.Confirmed ? "bblock" : "oblock"))"></div></td>
            </tr>
        </table>
    </div>


    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
    @if (Model.TaskStatus == CommonLibrary.TaskStatus.InConsideration)
    {
        <div class="form-group">
            <label asp-for="DateTime" class="control-label"></label>
            <input asp-for="DateTime" readonly="readonly" class="form-control" />
            <span asp-validation-for="DateTime" class="text-danger"></span>
        </div>
    }
    @if (Model.TaskStatus == null)
    {
        <div class="form-group">
            <label asp-for="Photos" class="control-label"></label>
            @foreach (var photo in Model.Photos)
            {
                <img style="width:100px; height: 100px" src="data:image/png;base64,@(Convert.ToString(photo.Image))" />
            }
        </div>
        <div class="form-group">
            <label asp-for="Name" class="control-label"></label>
            <input asp-for="Name" class="form-control" />
            <span asp-validation-for="Name" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Description" class="control-label"></label>
            <input asp-for="Description" class="form-control" />
            <span asp-validation-for="Description" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Category" class="control-label"></label>
            <select asp-for="Category" asp-items="new SelectList(Enum.GetValues(typeof(CommonLibrary.Category)))" class="form-control"></select>
            <span asp-validation-for="Category" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="House" class="control-label"></label>
            <input asp-for="House" class="form-control" />
            <span asp-validation-for="House" class="text-danger"></span>
        </div>
    }
    @if (Model.TaskStatus == CommonLibrary.TaskStatus.InProgress)
    {
        <div class="form-group">
            <label asp-for="Photos" class="control-label"></label>
            @foreach (var photo in Model.PhotosResult)
            {
                <img style="width:100px; height: 100px" src="data:image/png;base64,@(Convert.ToString(photo.Image))" />
            }
        </div>
    }
    @if (Model.TaskStatus == CommonLibrary.TaskStatus.InConsideration)
    {
        <div class="form-group">
            <label asp-for="Worker" class="control-label"></label>
            <select asp-for="Worker" asp-items="new SelectList(workers.Select(x => x.Name), workers.Select(x => x.ID))" class="form-control"></select>
            <span asp-validation-for="Worker" class="text-danger"></span>
        </div>
    }
    @if (Model.TaskStatus == CommonLibrary.TaskStatus.Mark)
    {
        <div class="form-group">
            <label asp-for="Rate" class="control-label"></label>
            <select asp-for="Rate" disabled asp-items="new SelectList(Enum.GetValues(typeof(CommonLibrary.Rate)))" class="form-control"></select>
            <span asp-validation-for="Rate" class="text-danger"></span>
        </div>
        <div class="form-group">
            <label asp-for="Comment" class="control-label"></label>
            <input asp-for="Comment" readonly="readonly" class="form-control" />
            <span asp-validation-for="Comment" class="text-danger"></span>
        </div>
    }
    <div class="form-group" style="margin-top: 10px">
        @switch (Model.TaskStatus)
        {
            case CommonLibrary.TaskStatus.InConsideration:
                <input type="submit" value="Выдать задачу" />
                break;
            case CommonLibrary.TaskStatus.InProgress:
                <input type="submit" value="Завершить выполнение" />
                break;
            default:
                <input type="submit" value="Подтвердить" class="btn btn-primary" />
                <input type="submit" value="Отклонить" class="btn btn-primary" />
                break;
        }
    </div>

</form>

<div>
    <a asp-action="Index">Back to List</a>
</div>